@prefix rr:  <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql:  <http://semweb.mmlab.be/ns/ql#> .
@prefix ex:  <http://example.org/group23/> .
@prefix sosa: <http://www.w3.org/ns/sosa/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@base <http://example.org/group23/> .

# Logical source common: CSV file in data/ (use the preprocessed comma CSV)
# TriplesMap for Station
<#StationTriplesMap>
  a               rr:TriplesMap ;
  rml:logicalSource [
    rml:source "data/calair_tiemporeal_comma.csv" ;
    rml:referenceFormulation ql:CSV ;
    # rml:iterator "" .   # normalmente vacío para CSV; muchos procesadores aceptan no ponerlo
  ] ;
  rr:subjectMap [
    rr:template "http://example.org/group23/station/{PUNTO_MUESTREO}" ;
    rr:termType rr:IRI
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdf:type ;
    rr:objectMap [ rr:constant ex:Station ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:provinceCode ;
    rr:objectMap [ rml:reference "PROVINCIA" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:municipalityCode ;
    rr:objectMap [ rml:reference "MUNICIPIO" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:stationCode ;
    rr:objectMap [ rml:reference "ESTACION" ; rr:datatype xsd:string ]
  ] .

# TriplesMap for Measurements (example for hour 01 — réplica para otras horas si quieres)
<#Measurement_H01_TriplesMap>
  a rr:TriplesMap ;
  rml:logicalSource [
    rml:source "data/calair_tiemporeal_comma.csv" ;
    rml:referenceFormulation ql:CSV ;
  ] ;
  rr:subjectMap [
    rr:template "http://example.org/group23/measurement/{PUNTO_MUESTREO}_{ANO}-{MES}-{DIA}-01" ;
    rr:termType rr:IRI
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdf:type ;
    rr:objectMap [ rr:constant sosa:Observation ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate sosa:hasFeatureOfInterest ;
    rr:objectMap [ rr:template "http://example.org/group23/station/{PUNTO_MUESTREO}" ; rr:termType rr:IRI ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:pollutantCode ;
    rr:objectMap [ rml:reference "MAGNITUD" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate sosa:resultTime ;
    rr:objectMap [
      # Construimos string 'YYYY-MM-DDThh:00:00' — Asegúrate que MES y DIA tienen 2 dígitos
      rr:template "{ANO}-{MES}-{DIA}T01:00:00" ;
      rr:datatype xsd:dateTime
    ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate sosa:hasSimpleResult ;
    rr:objectMap [ rml:reference "H01" ; rr:datatype xsd:decimal ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:validation ;
    rr:objectMap [ rml:reference "V01" ; rr:datatype xsd:string ]
  ] .
